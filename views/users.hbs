<div id="frame">
    <div id="sidepanel">
        <div id="profile">
            <div class="wrap">
                <img id="profile-img" src="https://ptetutorials.com/images/user-profile.png" class="online" alt="" />
                <p>{{currentUser}}</p>
            </div>
        </div>
        <div id="search">
            <label for=""><i class="fa fa-search" aria-hidden="true"></i></label>
            <input type="text" placeholder="Search contacts..." />
        </div>
        <div id="contacts">
            <ul id="all-users">
                {{#each users}}
                <li class="contact" data-username="{{name}}">
                    <div class="wrap">
                        <span class="contact-status online"></span>
                        <img src="https://ptetutorials.com/images/user-profile.png" alt="" />
                        <div class="meta">
                            <p class="name">{{name}}</p>
                            {{!-- <p class="preview">You just got LITT up, Mike.</p> --}}
                        </div>
                    </div>
                </li>
                {{/each}}
            </ul>
        </div>
    </div>
    <div class="content">
        <div class="contact-profile">
            <img src="https://ptetutorials.com/images/user-profile.png" alt="" />
            <p>Harvey Specter</p>
        </div>
        <div class="messages">
            <ul>
                <li class="sent">
                    <img src="https://ptetutorials.com/images/user-profile.png" alt="" />
                    <p>How the hell am I supposed to get a jury to believe you when I am not even sure that I do?!</p>
                </li>
                <li class="replies">
                    <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
                    <p>When you're backed against the wall, break the god damn thing down.</p>
                </li>
            </ul>
        </div>
        <div class="message-input">
            <div class="wrap">
                <input type="text" placeholder="Write your message..." />
                {{!-- <i class="fa fa-paperclip attachment" aria-hidden="true"></i> --}}
                <button class="submit"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
            </div>
        </div>
    </div>
</div>
<script src='//production-assets.codepen.io/assets/common/stopExecutionOnTimeout-b2a7b3fe212eaa732349046d8416e00a9dec26eb7fd347590fbced3ab38af52e.js'></script>
<script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
<script>
    var currentRoomID = "";
    $(".content").hide();
    $(".messages").animate({ scrollTop: $(document).height() }, "fast");

    var socket = io('/chat', { transports: ['websocket'] });
    socket.on('connect', function () {

        $(".contact").click(function () {
            currentRoomID = $(this).data("username");
            $(".contact-profile p").text(currentRoomID);
            $(".content").show();
        });
        socket.on('updateUsers', function (iUser) {
            UpdateUsers(iUser);
        });

        function newMessage(iMsg) {
            if ($.trim(iMsg.messageContent) == '') {
                return false;
            }
            $('<li class="sent"><img src="https://ptetutorials.com/images/user-profile.png" alt="" /><p>' + message + '</p></li>').appendTo($('.messages ul'));
            $('.message-input input').val(null);
            $('.contact.active .preview').html('<span>You: </span>' + iMsg.messageContent);
            $(".messages").animate({ scrollTop: $(document).height() }, "fast");
        };
        function UpdateUsers(iUser) {
            var users = $('#all-users');
            var liComp = $('<li>').addClass("contact");
            liComp.attr("data-username", iUser);
            var divComp = $('<div>').addClass("wrap");
            var spanElem = $('<span>').addClass("contact-status").addClass("online");
            var imgElem = $('<img>').attr("src", "https://ptetutorials.com/images/user-profile.png");
            var metaElem = $('<div>').addClass("meta").append($('<p>').addClass("name").text(iUser));
            divComp.append(spanElem);
            divComp.append(imgElem);
            divComp.append(metaElem);
            liComp.append(divComp);
            users.append(liComp);
        }

        $('.submit').click(function () {
            var message = {
                messageContent: $(".message-input input").val(),
                username: '{{currentUser}}',
                date: Date.now()
            };
            socket.emit("newMessage", currentRoomID, message);
            newMessage(message);
        });

        socket.on("addMessage", function (iMsg) {
            newMessage(iMsg);
        });

        $(window).on('keydown', function (e) {
            var message = {
                messageContent: $(".message-input input").val(),
                username: '{{currentUser}}',
                date: Date.now()
            };
            if (e.which == 13) {
                newMessage(message);
                return false;
            }
        });
    });
</script>